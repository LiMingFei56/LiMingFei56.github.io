---
layout: post
title: "操作系统-进程"
categories: computer
tags: [opersys]
date: 2020-06-12
excerpt: "操作系统-进程"
---

## 操作系统-进程

> 一个具有一定独立功能的程序在一个数据集合上的一次动态执行过程.

进程的组成
* 程序的代码
* 程序处理的数据
* 程序计数器中的值, 指示下一条将运行的指令
* 一组通用的寄存器的当前值, 堆, 栈
* 一组系统资源(如打开的文件)
* 进程包含了正在运行的一个程序的所有状态信息

进程与程序的联系
* 程序是产生进程的基础
* 程序的每次运行构成不同的进程
* 进程是程序功能的体现
* 通过多次执行, 一个程序可对应多个进程; 通过调用关系, 一个进程可包括外个程序.

进程与程序的区别
* 进程是动态的, 程序是静态的
* 进程是程序的执行, 进程有核心态/用户态
* 进程是暂时的, 程序是永久的: 进程是一个状态变化的过程, 程序可长久保存
* 进程与程序的组成不同: 进程的组成包括程序\数据和进程控制块(即进程状态信息)

并发和并行
* 并发: 在一段时间内有多个进程在执行
* 并行: 在一个时刻有多个进程在执行

特点:
* 动态性
* 并发性
* 独立性
* 制约性

### 进程控制

`进程控制块`(Process Control Block, PCB). 操作系统为每个进程都维护一个PCB, 用来保存  
与该进程有关的各种状态信息, 是进程存在的唯一标识.

进程标识信息: 本进程的标识PID, 本进程的产生者标识PPID, 用户标识UID.
处理机状态信息保存区: 用户可见寄存器, 控制和状态寄存器, 栈指针.
进程控制信息: 调度和状态信息, 进程间通信信息, 存储管理信息, 进程所用资源, 有关数据结构
    连接信息

PCB使用链表组织, 同一状态的进程其PCB成一链表, 外个状态对应多个不同的链表. 因为进程的
状态是动态变化的, 使用链表方便删除和添加状态. 如果操作系统有特殊作用, 也可以使用索引
表.

### 进程状态

#### 进程生命期

* 进程创建 1: 初始进程; 2: 用户启动; 3: 程序启动
* 进程运行 选择就绪进程
* 进程等待 自身触发
* 进程唤醒 等待事件得到满足
* 进程结束 1: 正常退出; 2: 错误退出; 3: 致命错误; 4: 被其他进程所杀

基本状态
1: 就绪态
2: 运行态
3: 等待态

4: 创建态
5: 结束态

#### 进程挂起

进程没有占用内存空间. 

阻塞挂起状态(blocked suspend): 进程在外存并等待某事件的出现
就绪挂起状态(ready suspend): 进程在外存, 但只要进入内存即运行

选择挂起进程:
在内存
1. 阻塞到阻塞挂起
2. 就绪到就绪挂起
3. 运行到就绪挂起
在外存
4. 阻塞挂起到就绪挂起

状态队列: 每种状态都有一个队列. 挂起队列(notify) 如果一个事件只满足一个进程
, 那么只改变一个进程的状态.(notify_all)如果一个事件满足队列中的所有进程
, 那么改变所有进程的状态

### 线程

进程间如果需要紧密的协同工作, 那么1: 进程之间如何通信? 2: 维护进程的系统开销较大
(创建, 撤消, 切换)

线程: 1: 实体之间可以并发执行; 2: 实体之间共享相同的地址空间.

线程是进程当中的一条执行流程. 进程用来管理资源, 把执行过程交给线程.

线程控制块 thread control blocl, 线程有独立资源和共享资源

线程开销:
* 线程创建不用创建资源相关的内容, 进程已经创建
* 线程终止不用释放资源相关的内容
* 线程切换不用切换页表
* 线程不用通过内核通信

线程的种类:
1. 用户线程(协程): 程序控制调度的执行单元
2. 内核线程: 操作系统控制调度的执行单元
3. 轻量级进程: 在内核中实现, 支持用户线程. 

上下文切换使用汇编来实现

### 进程优化

1. fork vfork
2. copy-on-write

僵尸状态: 子进程exit()后, 资源释放, 但是PCD没有被释放, 等待被释放的状态.
