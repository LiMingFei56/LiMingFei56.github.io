---
layout: post
title: Audio
categories: mm
tags: [mm]
date: 2022-06-29
---

## Audio

### 声音

#### 处理流程

1. 音频采集(模数转换成PCM数据)
2. 音视频编码(音视频原数据, 编码压缩成小数据)
3. 传输
4. 音视频解码
5. 音视频渲染

#### 声音的产生

1. 声音是由物体振动产生
2. 它可以通过空气, 固体, 液体等进行传输
3. 振动耳膜

#### 人类听觉范围

> 1秒钟振动的次数
> 次声波 20Hz 可听声波 20kHz 超声波

#### 声音的三要素

* 音调: 音频的快慢
* 音量: 振动的幅度
* 音色: 谐波

#### 声音模数转换

1. 采样: 越大越真, 常用采样频率: 441000, 48000(一般), 32000, 16000, 8000
2. 10进制转成二进制方波
3. 保存二进制位数, 影响音量大小

原始数据格式:
1. PCM: 
2. WAV: PCM + 数据头

1. 采样大小(位深): 一个采样用多少bit存放. 常用的是16bit
2. 采样率: 8k, 16k, 32k, 44.1k, 48k
3. 声道数: 单, 双, 多                    
4. 码率: 采样率 * 采样大小 * 声道数 = PCM


### 采集音频的方式

#### Android

  AudioRecord: 偏低层
  MediaRecorder: 偏应用

#### iOS

  AudioUnit
  AVFoundation

#### Windows

  DirectShow
  OpenAl
  \>window7 audio cool

#### FFmpeg

  通过命令方式
  ffmpeg -f avfoundation -i :0 out.wav

#### FFmpeg采集音频流程

1. 打开输入设备
    #include "libavdevice/avdevice.h"
    #include "libavformat/avformat.h"

  注册设备
    avdevice_register_all();  
    
  设置采集方式
    AVInputFormat *iformat = av_find_input_format("avfoundation");
  打开音频设备
    AVFormatContext *fmt_ctx = NULL;
    AVDictionary *opetions = NULL;
    avformat_open_input(&fmt_ctx, ":0", iformat, &opetions);

    av_strerror 打印ffmpeg 错误信息
   

2. 读取数据
    av_read_frame

3. 将音频数据写入文件
    fopen() 打开文件
    fwrite(pkt.data, pkt.size, 1, outfile); 写入数据
    fclose(outfile);

## Reference
