---
layout: post
title: "Build Maven"
categories: build
tags: [build]
date: 2020-07-23
---

## Build Maven

### å¡åœ¨ `Generating project in Batch mode`

mvn å‘½ä»¤åŠ  -X å¯ä»¥çœ‹åˆ°è¯¦ç»†è¿‡ç¨‹, å¯ä»¥çœ‹åˆ°å¡åœ¨ä¸‹è½½`archetype-catalog.xml`

è§£å†³æ–¹æ³•å¾ˆç®€å•ã€‚
1. æŠŠä¸Šè¿°åœ°å€å¤åˆ¶åˆ°æµè§ˆå™¨ä¸­ï¼Œä¸‹è½½è¿™ä¸ªæ–‡ä»¶åˆ°æœ¬åœ°ã€‚
2. æŠŠæ–‡ä»¶archetype-catalog.xmlå¤åˆ¶åˆ°ç›®å½•.m2\repository\org\apache\maven\archetype\archetype-catalog\2.2ä¸‹é¢ã€‚
3. åœ¨ä¸Šè¿°å‘½ä»¤åå¢åŠ å‚æ•°-DarchetypeCatalog=localï¼Œå˜æˆè¯»å–æœ¬åœ°æ–‡ä»¶å³å¯ã€‚

### æŒ‡å®šç¼–è¯‘Javaç‰ˆæœ¬

    <maven.compiler.source>1.8</maven.compiler.source>
    <maven.compiler.target>1.8</maven.compiler.target>

### æ‰“æ‰§è¡ŒJarä¸€èˆ¬æœ‰ä¸‰ç§æ–¹å¼

maven-jar-plugin
maven-assembly-plugin
maven-shade-plugin
onejar-maven-plugin

#### maven-assembly-plugin
å·¥ä½œéœ€è¦assembly dependencies é…ç½®, ä¸ç„¶ä¼šæŠ¥`No assembly descriptors found`

    <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-assembly-plugin</artifactId>
        <executions>
            <execution>
                <id>make-assembly</id>
                <phase>package</phase>
                <goals>
                    <goal>single</goal>
                </goals>
            </execution>
        </executions>
        <configuration>
            <archive>
              <manifest>
                  <mainClass>
                      com.equick.sync.job.App
                  </mainClass>
              </manifest>
            </archive>
            <descriptorRefs>
                <descriptorRef>jar-with-dependencies</descriptorRef>
            </descriptorRefs>
        </configuration>
    </plugin>

ä½¿ç”¨`mvn package assembly:single`


### maven è®¾ç½®javac é€‰é¡¹

    <compilerArgs>
      <arg>-Xmaxerrs</arg>
      <arg>1000</arg>
      <arg>-Xlint</arg>
      <arg>-J-Duser.language=en_us</arg>
    </compilerArgs>

    
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <version>3.8.1</version>
        <configuration>
          <verbose>true</verbose>
          <fork>true</fork>
          <compilerArgs>
            <arg>-g</arg>
          </compilerArgs>
          <executable>javac</executable>
          <compilerVersion>1.8</compilerVersion>
        </configuration>
      </plugin>

### Maven jdb 

    // Java Application
    mvn exec:exec -Dexec.executable="java" -Dexec.args="-classpath %classpath -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=1044 com.mycompany.app.App"
    mvn -Dtest=MySuperClassTest -Dmaven.surefire.debug test

    // Spring Boot Application
    <project>
      ...
      <build>
        ...
        <plugins>
          ...
          <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
            <version>2.2.1.RELEASE</version>
            <configuration>
              <jvmArguments>
                -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005
              </jvmArguments>
            </configuration>
            ...
          </plugin>
          ...
        </plugins>
        ...
      </build>
      ...
    </project>

    mvn spring-boot:run -Dspring-boot.run.jvmArguments="-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=5005"

### Maven èµ„æºæ–‡ä»¶

    src/main/resouceså’Œsrc/test/resources

    <build>
      <resources>
        <resource>
          <directory>src/main/resources</directory>
          <includes>
            <include>**/*</include>
          </includes>
        </resource>
      </resources>
    </build>

è¯»å–jarä¸­çš„æ–‡ä»¶
    getClass().getResourceAsStream("3Columns.csv")

    val file = new File(getClass.getResource("zipcode_data.csv").toURI)

    ClassLoader CLDR = this.getClass().getClassLoader();
    InputStream inputStream = CLDR.getResourceAsStream("com/devdaily/desktopcurtain/sounds/" + soundfileName);
[Java Jar file: How to read a file from a Jar file](https://alvinalexander.com/blog/post/java/read-text-file-from-jar-file/)  


1. Class.getResourceAsStream(String path) ï¼š path ä¸ä»¥â€™/'å¼€å¤´æ—¶é»˜è®¤æ˜¯ä»æ­¤ç±»æ‰€åœ¨çš„åŒ…ä¸‹å–èµ„æºï¼Œä»¥â€™/'å¼€å¤´åˆ™æ˜¯ä»

ClassPathæ ¹ä¸‹è·å–ã€‚å…¶åªæ˜¯é€šè¿‡pathæ„é€ ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”±ClassLoaderè·å–èµ„æºã€‚

2. Class.getClassLoader.getResourceAsStream(String path) ï¼šé»˜è®¤åˆ™æ˜¯ä»ClassPathæ ¹ä¸‹è·å–ï¼Œpathä¸èƒ½ä»¥â€™/'å¼€å¤´ï¼Œæœ€ç»ˆæ˜¯ç”±

ClassLoaderè·å–èµ„æºã€‚

3. ServletContext. getResourceAsStream(String path)ï¼šé»˜è®¤ä»WebAPPæ ¹ç›®å½•ä¸‹å–èµ„æºï¼ŒTomcatä¸‹pathæ˜¯å¦ä»¥â€™/'å¼€å¤´æ— æ‰€è°“ï¼Œ

å½“ç„¶è¿™å’Œå…·ä½“çš„å®¹å™¨å®ç°æœ‰å…³ã€‚

4. Jspä¸‹çš„applicationå†…ç½®å¯¹è±¡å°±æ˜¯ä¸Šé¢çš„ServletContextçš„ä¸€ç§å®ç°ã€‚

### Reference
[Apache Maven Project](http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html)  
[How to Create an Executable JAR with Maven](https://www.baeldung.com/executable-jar-with-maven)  
[Mavenå°†ä»£ç åŠä¾èµ–æ‰“æˆä¸€ä¸ªJaråŒ…çš„æ–¹å¼](https://www.cnblogs.com/zhangwuji/p/10040834.html)  
[Maven3ç§æ‰“åŒ…æ–¹å¼ä¹‹ä¸€maven-assembly-pluginçš„ä½¿ç”¨](https://www.cnblogs.com/xd502djj/p/12162335.html)  
[mvn assembly:singleæ‰“åŒ…æŠ¥é”™:Error reading assemblies: No assembly descriptors found](https://blog.csdn.net/znsqingfeng/article/details/51302033)  
[compiler:compile](http://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html#compilerArgs)  

[Spring Boot Maven Plugin Documentation](https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/)
